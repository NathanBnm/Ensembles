app-id: com.github.subhadeepjasu.ensembles
runtime: io.elementary.Platform
runtime-version: daily
sdk: io.elementary.Sdk
command: com.github.subhadeepjasu.ensembles
finish-args: 
  - '--share=ipc'
  - '--socket=fallback-x11'
  - '--socket=wayland'
  - '--socket=pulseaudio'
  - '--device=all'
  - '--filesystem=home'
  # Required for system wide dark style preference
  - '--system-talk-name=org.freedesktop.Accounts'
  # Required for media keys and MPRIS access
  - '--own-name=org.mpris.MediaPlayer2.com.github.subhadeepjasu.ensembles'
  - '--talk-name=org.gnome.SettingsDaemon.MediaKeys'
modules:
  - name: granite
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/elementary/granite.git

  - name: fluidsynth
    buildsystem: cmake-ninja
    config-opts:
      - -DLIB_SUFFIX=
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/man
      - '*.so'
    sources:
      - type: archive
        url: https://github.com/FluidSynth/fluidsynth/archive/refs/tags/v2.2.1.tar.gz
        sha256: 1c56660f23f6c406b36646cc619fc2d2a5265d1d3290e79bcef4505bcd985fdd
  
  - name: libhandy-1
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/libhandy.git
  
  - name: portmidi
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_LIBRARY_OUTPUT_DIRECTORY=/app/lib
      - -DCMAKE_ARCHIVE_OUTPUT_DIRECTORY=/app/lib
      - -DCMAKE_RUNTIME_OUTPUT_DIRECTORY=/app/bin
    post-install:
      - ln -s libportmidi.so /app/lib/libporttime.so
    sources:
      - type: archive
        url: https://sourceforge.net/projects/portmedia/files/portmidi/217/portmidi-src-217.zip
        sha256: 08e9a892bd80bdb1115213fb72dc29a7bf2ff108b378180586aa65f3cfd42e0f
      - type: patch
        path: patches/portmidi-no-java.patch
    cleanup:
      - /bin
      - /lib/pkgconfig
      - /include
      - '*.a'
      - '*.la'

  - name: ensembles
    buildsystem: meson
    sources:
      - type: dir
        path: .
  
  - name: ensemblesGMSoundfonts
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.com/SubhadeepJasu/ensemblesgmsoundfont/-/archive/v0.0.2/ensemblesgmsoundfont-v0.0.2.tar.gz
        sha256: c292bd20215e1aec6510182765bb218e0867454f3cb3b09df9c8f66dead41e9b
